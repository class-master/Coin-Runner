# Day5：ハイスコアとチャレンジ演出の日（7人×3時間用シナリオ）

## 0. 今日のゴール（先生が最初に読む用）

3時間で、次を「クラス全体」として完成させます。

1. 1プレイごとに **スコア（Score）が集計** される
2. 今までのプレイの中で一番高いスコアを **ベストスコア（Best）として記録** できる
3. GameOver 時に「ベスト更新かどうか」を判定し、メッセージや演出で伝えられる

> ポイント：  
> Day1〜Day4 で作ってきた「走る・跳ぶ・避ける・演出」のゲームに、  
> 今日は **「やり込んだぶんだけ嬉しい仕掛け（ハイスコア）」** を足していきます。


---

## 1. 今日の7人の役割（先に割り当てる）

| No | 役割名                                | 触るファイル                          | ざっくりやること                               |
|----|---------------------------------------|----------------------------------------|-----------------------------------------------|
| A  | スコアサービス拡張担当               | `core/scoring.py`                      | 現在スコア + ベストスコアのロジックを考える   |
| B  | HUD 表示拡張担当                     | `ui/hud.py` / HUD を呼び出すコード    | Score/Speed に Best 表示を足す                |
| C  | GameOver メッセージ担当              | `scenes/game_over_scene.py` ほか      | NEW RECORD! の表示条件とメッセージを決める    |
| D  | ゲーム本体とのつなぎ込み担当         | `scenes/play.py` / 必要なら `main.py` | ゲーム終了時に ScoringService に通知する      |
| E  | バランス＆演出調整担当               | `config.py` / GameOver の見た目など   | プレイヤーが達成感を得られるスコア感を調整    |
| F  | テスト＆リトライ動作確認担当         | 全体                                   | Retry/Exit 後もハイスコアが正しく残るか確認   |
| G  | バグログ＆ふりかえり記録担当         | `docs/Day5/Day5_buglog.md`            | 全員から情報を集めて記録する                   |

> 先生へ：  
> いつものように A〜G に生徒の名前を書き込んでから配布してください。  
> 役割は途中で相談して入れ替えてもOKです。

---

## 2. 今日の時間割（板書用）

- 0:00〜0:15　役割説明・仕様の読み合わせ（このプリントを見る）
- 0:15〜1:10　**個人作業**（A〜D中心、E/F/Gは全体を観察）
- 1:10〜1:30　ハイスコアが正しく動いているか全員でテスト
- 1:30〜2:30　**チームで調整＆演出追加**
- 2:30〜2:50　バグログ整理・ふりかえりを書く
- 2:50〜3:00　今日の成果をみんなでプレイして発表

---

## 3. 役割ごとの詳細タスク

### 3-1. A：スコアサービス拡張担当（`core/scoring.py`）

- [ ] `ScoringService` のクラス説明コメントを読む
- [ ] 「現在スコア」と「ベストスコア」をどう持つか、紙に下書きする
- [ ] フィールド案：`self._score`（現在スコア） / `self._best`（ベスト）
- [ ] `reset()` では「現在スコアだけ 0 に戻す」ようにする（ベストは保持）
- [ ] `register_game_over()` のようなメソッドを設計し、
      GameOver 時に呼び出して「ベスト更新なら True」を返す仕様を考える
- [ ] `current` と `best` の2種類のプロパティで値を取り出せるようにする

> ヒント：  
> - 「Score クラスを2つ持つ」という設計にすると、値の扱いが分かりやすい。  
> - Day5 の時間内で終わりそうかを E/F と相談しながら、やりすぎないようにする。


### 3-2. B：HUD 表示拡張担当（`ui/hud.py`）

- [ ] HUD の docstring を読んで、Score/Speed がどう作られているか確認
- [ ] `get_labels()` の戻り値に、`"best": "Best: xxx"` を追加する設計を考える
- [ ] A と相談して、`scoring_service.best` というプロパティ名でそろえる
- [ ] ラベルのフォーマット（空白や大文字小文字）をチームで決める
- [ ] Play 画面側で HUD の `"best"` が使われているか確認し、足りなければTODOコメントを入れる

> 例:  
> - `Score: 120`  
> - `Best: 350`  
> - `Speed: x1.20 (Lv.3)`  


### 3-3. C：GameOver メッセージ担当（`scenes/game_over_scene.py` ほか）

- [ ] `GameOverScene` のコメントを読み、今どんな責務だけを持っているか整理
- [ ] 「GameOver 画面のラベル」や「NEW RECORD!」をどこで描画しているか探す
- [ ] A/B と相談し、「ベスト更新かどうか」を受け取る方法を決める
      - 例：GameOverScene に `is_new_record` フィールドを持たせる
- [ ] ベスト更新なら `"NEW RECORD!"` を、そうでなければ `"Try Again!"` など
      メッセージの文言を決め、プログラムに反映する


### 3-4. D：ゲーム本体とのつなぎ込み担当（`scenes/play.py` / `main.py`）

- [ ] ゲームの「1プレイ」がどこで終わるかコードで確認する
      - 例：`self.game_over = True` にしている行
- [ ] GameOver に遷移するタイミングで `ScoringService.register_game_over()` を呼び出す場所を考える
- [ ] 戻り値（True/False）を GameOver 画面に渡す方法を C と一緒に検討する
- [ ] Retry 時にスコアが 0 に戻る・ベストが残ることを確認する


### 3-5. E：バランス＆演出調整担当（`config.py` ほか）

- [ ] Day1〜Day4 で調整してきたパラメータを読み返す
- [ ] 「何点ぐらい取れたら嬉しいか？」をクラスで相談して、目安スコアを決める
- [ ] 取りやすいコインの数や、1回あたりのスコア（avoid_point）を調整する
- [ ] GameOver 時のメッセージの色やフォントサイズなど、
      無理のない範囲で演出を追加する（コードにコメントを残す）


### 3-6. F：テスト＆リトライ動作確認担当（全体）

- [ ] 以下のパターンで実際にプレイして確認する：
    - すぐに障害物に当たる
    - そこそこ遊んでから GameOver になる
    - ベストスコアを更新したあと、もう一度プレイする
- [ ] それぞれのパターンで「Score / Best / メッセージ」が正しいかチェックリストを作る
- [ ] Retry/Exit を何度か繰り返しても、値がおかしくならないか確認する
- [ ] 見つけたバグはすべて G に伝え、`Day5_buglog.md` に書き込んでもらう


### 3-7. G：バグログ＆ふりかえり記録担当（`docs/Day5/Day5_buglog.md`）

- [ ] 各担当から「困ったこと」「直したこと」「まだ悩んでいること」を聞き出す
- [ ] バグ1つごとに「再現手順 → 原因 → 対応」を Markdown でまとめる
- [ ] 最後に、「次に同じようなゲームを作るときに気をつけたいこと」をクラス全体で1行ずつ書いてもらう


---

## 4. 今日のチェックリスト（先生用）

- [ ] プレイ中に Score が増えている
- [ ] 2回目以降のプレイで Best が更新されている
- [ ] GameOver のメッセージがベスト更新かどうかで変わる
- [ ] Retry/Exit を繰り返してもスコア表示が壊れない
- [ ] `docs/Day5/Day5_buglog.md` に、今日見つけたバグと対策が整理されている

---

## 5. 今日のまとめメモ欄（クラス用）

- 今日できたこと：

- ハイスコアの設計で悩んだポイント：

- 「次に作りたいゲーム」や「入れてみたいスコアの仕組み」：

